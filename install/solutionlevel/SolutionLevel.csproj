<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <SolutionDir Condition="'$(SolutionDir)' == '' or '$(SolutionDir)' == '*undefined*'">$(MSBuildProjectDirectory)\..</SolutionDir>
    <ProjectGuid>{B0B1C32A-53FC-4B7E-BA60-6DAFB8180A42}</ProjectGuid>
    <OutputType>Library</OutputType>
    <RootNamespace>SolutionLevel</RootNamespace>
    <AssemblyName>SolutionLevel</AssemblyName>
  </PropertyGroup>
  <Import Project="$(SolutionDir)\CsBaseConfiguration.targets" />
  <ItemGroup>
    <EmbeddedResource Include="SolutionLevel.readme" />
  </ItemGroup>
  <PropertyGroup>
    <BuildConfiguration Condition=" '$(BuildConfiguration)' == ''">Debug</BuildConfiguration>
    <BuildPlatform Condition=" '$(BuildPlatform)' == ''">Any CPU</BuildPlatform>
    <BuildPlatformTranslated>$(BuildPlatform.Replace(" ",""))</BuildPlatformTranslated>
    
    <DirWorkspace>$(SolutionDir)\..</DirWorkspace>
    <DirTemplates>$(DirWorkspace)\templates</DirTemplates>
    <DirBuild>$(DirWorkspace)\build</DirBuild>
    <DirBuildBin>$(DirBuild)\bin\$(BuildPlatformTranslated)\$(BuildConfiguration)</DirBuildBin>
    <DirBuildTemp>$(DirBuild)\temp</DirBuildTemp>
    <DirResource>$(DirWorkspace)\resource</DirResource>
    
    <!-- File templates -->
    <FileTemplateVersion>$(DirTemplates)\VersionNumber.wxi.in</FileTemplateVersion>
    <FileTemplateDependencies>$(DirTemplates)\Dependencies.wxi.in</FileTemplateDependencies>
    
    <!-- Generated files -->
    <FileGeneratedVersion>$(DirBuildTemp)\VersionNumber.wxi</FileGeneratedVersion>
    <FileGeneratedDependencies>$(DirBuildTemp)\Dependencies.wxi</FileGeneratedDependencies>
    
    <!-- Version number -->
    <VersionMajor>0</VersionMajor>
    <VersionMinor>0</VersionMinor>
    <VersionBuild>0</VersionBuild>
    <VersionRevision>0</VersionRevision>
    
    <MsBuildExtensionsPath>$(DirTools)\msbuild.extensions</MsBuildExtensionsPath>
  </PropertyGroup>
  <Import Project="$(MsBuildExtensionsPath)\TemplateFile.msbuild" Condition="Exists('$(MsBuildExtensionsPath)\TemplateFile.msbuild')" />
  <Import Project="$(DirWorkspace)\version.xml" Condition="Exists('$(DirWorkspace)\version.xml')" />
  
  <!-- Clean up all the files we generate ourselves -->
  <PropertyGroup>
    <CleanDependsOn>
            CleanGeneratedFiles;
            $(CleanDependsOn);
        </CleanDependsOn>
  </PropertyGroup>
  <Target Name="CleanGeneratedFiles">
    <ItemGroup>
      <GeneratedFiles Include="$(FileGeneratedVersion)" />
      <GeneratedFiles Include="$(FileGeneratedDependencies)" />
    </ItemGroup>
    <Delete Files="@(GeneratedFiles)" />
  </Target>
  
  <!-- Just before we start building we'll generate the AssemblyInfo.XX.cs files-->
  <PropertyGroup>
    <BuildDependsOn>
            GenerateVersionNumber;
            GenerateDependencies;
            $(BuildDependsOn);
        </BuildDependsOn>
  </PropertyGroup>
  <Target Name="GenerateVersionNumber">
    <!-- Generate the version number file -->
    <ItemGroup>
      <VersionTokens Include="Major">
        <ReplacementValue>$(VersionMajor)</ReplacementValue>
      </VersionTokens>
      <VersionTokens Include="Minor">
        <ReplacementValue>$(VersionMinor)</ReplacementValue>
      </VersionTokens>
      <VersionTokens Include="Build">
        <ReplacementValue>$(VersionBuild)</ReplacementValue>
      </VersionTokens>
    </ItemGroup>
    <TemplateFile Template="$(FileTemplateVersion)" OutputFileName="$(FileGeneratedVersion)" Tokens="@(VersionTokens)" />
    
    <Message Text="File $(FileTemplateVersion)" Condition="Exists('$(FileTemplateVersion)')" />
    <Message Text="File $(FileGeneratedVersion)" Condition="Exists('$(FileGeneratedVersion)')" />
  </Target>
  
  <Target Name="GenerateDependencies">
    <ItemGroup>
      <BuildInfoTokens Include="DirBin">
        <ReplacementValue>$(DirBuildBin)</ReplacementValue>
      </BuildInfoTokens>
      <BuildInfoTokens Include="DirResource">
        <ReplacementValue>$(DirResource)</ReplacementValue>
      </BuildInfoTokens>
      <BuildInfoTokens Include="DirInstall">
        <ReplacementValue>$(SolutionDir)</ReplacementValue>
      </BuildInfoTokens>
    </ItemGroup>
    <TemplateFile Template="$(FileTemplateDependencies)" OutputFileName="$(FileGeneratedDependencies)" Tokens="@(BuildInfoTokens)" />
    
    <Message Text="File $(FileTemplateDependencies)" Condition="Exists('$(FileTemplateDependencies)')" />
    <Message Text="File $(FileGeneratedDependencies)" Condition="Exists('$(FileGeneratedDependencies)')" />
  </Target>
</Project>